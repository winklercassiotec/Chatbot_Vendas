<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chat de Vendas - HÃ³stias</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#eceff1; }
  .chat-container { display:flex; flex-direction:column; max-width:480px; height:100vh; margin:0 auto; border:1px solid #ccc; background:#fff; }
  .messages { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; background:#f5f5f5; }
  .message { margin:5px 0; padding:10px 14px; border-radius:18px; max-width:75%; word-wrap:break-word; line-height:1.4; white-space:pre-wrap;}
  .from-system { background:#ffffff; align-self:flex-start; }
  .from-user { background:#d1f4d1; align-self:flex-end; }
  .option-btn { background:#2196f3; color:#fff; border:none; border-radius:20px; padding:8px 14px; cursor:pointer; margin-top:5px; display:inline-block; transition:background-color 0.3s ease; }
  .option-btn:hover { background-color:#1565c0; }
  .option-container { display:flex; flex-wrap:wrap; gap:5px; margin-top:5px; }
  .input-container { display:flex; padding:10px; background:#f0f0f0; border-top:1px solid #ccc; }
  .input-container input { flex:1; border-radius:25px; border:1px solid #ccc; padding:10px 15px; outline:none; font-size:14px; }
  .input-container button { margin-left:8px; border:none; background:#2196f3; color:white; border-radius:50%; width:40px; height:40px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:18px; }
</style>
</head>
<body>

<div class="chat-container">
  <div id="messages" class="messages"></div>
  <div id="inputArea" class="input-container">
    <input id="chatInput" type="text" placeholder="Digite algo para iniciar..." autocomplete="off" />
    <button id="sendBtn">&#9658;</button>
  </div>
</div>

<script>
const messagesEl = document.getElementById('messages');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');

const PRODUTOS = [
  {nome:"HÃ³stia para fiÃ©is 3,5 cm"},
  {nome:"HÃ³stia para fiÃ©is 4,0 cm"},
  {nome:"HÃ³stia para celebrante 6,8 cm"},
  {nome:"HÃ³stia para celebrante 7,5 cm"}
];

let cliente = {
  cnpj:"", empresa:"", telefone:"", emailFat:"", emailFin:"", responsavel:""
};
let pedido = { itens: [] };

function getLocal(key){ return JSON.parse(localStorage.getItem(key) || '[]'); }
function setLocal(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

function addMessage(text, from='system'){
  const div=document.createElement('div');
  div.classList.add('message', from==='system'?'from-system':'from-user');
  div.innerText=text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop=messagesEl.scrollHeight;
}

function createInput(placeholder, callback){
  chatInput.value='';
  chatInput.placeholder=placeholder;
  sendBtn.onclick=()=>{
    const val=chatInput.value.trim();
    if(!val) return;
    addMessage(val,'user');
    chatInput.value='';
    callback(val);
  };
  chatInput.focus();
}

function startChat(){
  addMessage('OlÃ¡! ðŸ˜Š Sou a assistente virtual de vendas.');
  addMessage('Para comeÃ§ar, digite o CNPJ da sua empresa:');
  createInput('CNPJ', cnpj => {
    cliente.cnpj = cnpj;
    askEmpresa();
  });
}

function askEmpresa(){
  addMessage('Nome da Empresa:');
  createInput('Nome da Empresa', nome=>{
    cliente.empresa = nome;
    askTelefone();
  });
}
function askTelefone(){
  addMessage('Telefone ou Whatsapp:');
  createInput('Telefone', tel=>{
    cliente.telefone = tel;
    askEmailFat();
  });
}
function askEmailFat(){
  addMessage('E-mail para faturamento:');
  createInput('E-mail faturamento', email=>{
    cliente.emailFat = email;
    askEmailFin();
  });
}
function askEmailFin(){
  addMessage('E-mail para financeiro:');
  createInput('E-mail financeiro', email=>{
    cliente.emailFin = email;
    askResponsavel();
  });
}
function askResponsavel(){
  addMessage('Nome do responsÃ¡vel pelo pedido:');
  createInput('ResponsÃ¡vel', nome=>{
    cliente.responsavel = nome;
    askProdutos();
  });
}

function askProdutos(){
  addMessage('Selecione os produtos que deseja comprar:');
  const container=document.createElement('div');
  container.classList.add('option-container');
  PRODUTOS.forEach(p=>{
    const btn=document.createElement('button');
    btn.classList.add('option-btn');
    btn.innerText=p.nome;
    btn.onclick=()=>{
      addMessage(p.nome,'user');
      askQuantidade(p.nome);
    };
    container.appendChild(btn);
  });
  messagesEl.appendChild(container);
  messagesEl.scrollTop=messagesEl.scrollHeight;
}

function askQuantidade(produto){
  addMessage(`Informe a quantidade de "${produto}":`);
  createInput('Quantidade', qtd=>{
    pedido.itens.push({produto, quantidade:qtd});
    addMessage('Produto adicionado!');
    addMessage('Deseja adicionar outro produto? (sim/nÃ£o)');
    createInput('sim ou nÃ£o', resp=>{
      if(resp.toLowerCase().startsWith('s')) askProdutos();
      else finalizarPedido();
    });
  });
}

function finalizarPedido(){
  addMessage('Finalizando o pedido...');
  const pedidos = getLocal('pedidos');
  const novoPedido = {
    id: Date.now(),
    cliente,
    itens: pedido.itens,
    data: new Date().toISOString()
  };
  pedidos.push(novoPedido);
  setLocal('pedidos', pedidos);
  addMessage('âœ… Pedido registrado com sucesso!');
  /*addMessage('VocÃª pode visualizar seus pedidos em "pedidos_local.html".');*/
  cliente = {}; pedido = {itens:[]};
  setTimeout(startChat,2000);
}

startChat();
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ sendBtn.click(); e.preventDefault(); }});
</script>
</body>
</html>
